# üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –¥–µ–ø–ª–æ—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Ubuntu 20.04+ (–∏–ª–∏ –¥—Ä—É–≥–æ–π Linux)
- Python 3.11+
- PostgreSQL 12+
- –î–æ—Å—Ç—É–ø –ø–æ SSH –∫ —Å–µ—Ä–≤–µ—Ä—É

---

## 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Å–∏—Å—Ç–µ–º—ã:

```bash
sudo apt update
sudo apt install -y python3 python3-pip postgresql postgresql-contrib
```

### –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL:

```bash
# –í–æ–π—Ç–∏ –≤ PostgreSQL
sudo -u postgres psql

# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE DATABASE taskbot_db;
CREATE USER taskbot_user WITH ENCRYPTED PASSWORD 'your_secure_password';
GRANT ALL PRIVILEGES ON DATABASE taskbot_db TO taskbot_user;
\q
```

---

## 2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä:

```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
scp -r app/ bot.py START_BOT.sh user@your_server:/home/user/taskbot/

# –ò–ª–∏ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –∏–∑ git
ssh user@your_server
cd /home/user
git clone <your_repo_url> taskbot
cd taskbot
```

### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:

```bash
cd /home/user/taskbot
pip3 install aiogram==3.22.0 psycopg2-binary==2.9.11 python-dotenv==1.2.1
```

---

## 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```bash
nano .env
```

### –î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```env
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
DATABASE_URL=postgresql://taskbot_user:your_secure_password@localhost:5432/taskbot_db
SESSION_SECRET=your_random_secret_key_here
```

**–ì–¥–µ –≤–∑—è—Ç—å —Ç–æ–∫–µ–Ω Telegram Bot:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather) –≤ Telegram
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/newbot` –∏–ª–∏ `/token` (–¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –±–æ—Ç–∞)
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω —Ñ–æ—Ä–º–∞—Ç–∞ `1234567890:ABCdefGHIjklMNOpqrsTUVwxyz`

**–í–∞–∂–Ω–æ:** –§–∞–π–ª `.env` –ù–ï –¥–æ–ª–∂–µ–Ω –ø–æ–ø–∞–¥–∞—Ç—å –≤ git! –î–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ `.gitignore`.

---

## 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç A: –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)

```bash
cd /home/user/taskbot
python3 bot.py
```

### –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

```bash
cd /home/user/taskbot
chmod +x START_BOT.sh
./START_BOT.sh
```

**–ú–µ–Ω—é —Å–∫—Ä–∏–ø—Ç–∞:**
- `1` - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤—Ä—É—á–Ω—É—é
- `2` - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
- `3` - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
- `4` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
- `5` - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
- `6` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ systemd —Å–ª—É–∂–±—É
- `7` - –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ (systemd)

### –í–∞—Ä–∏–∞–Ω—Ç C: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–∞–∫ systemd —Å–ª—É–∂–±–∞ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

**–ß–µ—Ä–µ–∑ –º–µ–Ω—é START_BOT.sh:**
1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `./START_BOT.sh`
2. –í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç `6` - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–∞–∫ systemd —Å–ª—É–∂–±—É
3. –í—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç `7` - –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**

```bash
sudo nano /etc/systemd/system/taskbot.service
```

–î–æ–±–∞–≤–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:

```ini
[Unit]
Description=Telegram Task Management Bot
After=network.target postgresql.service

[Service]
Type=simple
User=your_username
WorkingDirectory=/home/user/taskbot
Environment="PYTHONUNBUFFERED=1"
ExecStart=/usr/bin/python3 /home/user/taskbot/bot.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Å–ª—É–∂–±—É:

```bash
sudo systemctl daemon-reload
sudo systemctl enable taskbot.service
sudo systemctl start taskbot.service
```

---

## 5. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–æ–º —á–µ—Ä–µ–∑ systemd

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
sudo systemctl start taskbot

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞
sudo systemctl stop taskbot

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
sudo systemctl restart taskbot

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status taskbot

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u taskbot -f

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
tail -f /home/user/taskbot/logs/bot.log
```

---

## 6. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞ –ø–æ username
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É `/start`
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç

---

## 7. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–ß–µ—Ä–µ–∑ SQL (PostgreSQL):**

```bash
sudo -u postgres psql -d taskbot_db
```

```sql
-- –î–æ–±–∞–≤–∏—Ç—å –≤–∞—à username –≤ whitelist –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
INSERT INTO allowed_users (username, role, added_by_id) 
VALUES ('your_telegram_username', 'admin', 1);
```

**–í–∞–∂–Ω–æ:** –£–∫–∞–∂–∏—Ç–µ –≤–∞—à username –±–µ–∑ —Å–∏–º–≤–æ–ª–∞ `@`.

–¢–µ–ø–µ—Ä—å –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start` –±–æ—Ç—É - –≤—ã –±—É–¥–µ—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä!

---

## 8. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–π –ø–∞—Ä–æ–ª—å –¥–ª—è PostgreSQL
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ localhost)
- ‚úÖ –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ `.env` —Ñ–∞–π–ª –≤ git
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ firewall (ufw) –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –†–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

---

## 9. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞

```bash
cd /home/user/taskbot
git pull  # –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ git
sudo systemctl restart taskbot
```

---

## 10. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

```bash
# –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø
pg_dump -U taskbot_user -d taskbot_db > backup_$(date +%Y%m%d_%H%M%S).sql

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏–∑ –±—ç–∫–∞–ø–∞
psql -U taskbot_user -d taskbot_db < backup_20251117_120000.sql
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

```
/home/user/taskbot/
‚îú‚îÄ‚îÄ app/                      # –ú–æ–¥—É–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handlers/            # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ keyboards/           # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py          # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ logging_config.py    # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îú‚îÄ‚îÄ main.py              # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ   ‚îî‚îÄ‚îÄ states.py            # FSM —Å–æ—Å—Ç–æ—è–Ω–∏—è
‚îú‚îÄ‚îÄ logs/                     # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ bot.log              # –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ bot.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ START_BOT.sh             # –°–∫—Ä–∏–ø—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env                      # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (—Å–æ–∑–¥–∞—Ç—å)
‚îî‚îÄ‚îÄ DEPLOYMENT.md            # –≠—Ç–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
```

---

## Troubleshooting

### –ë–æ—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: `tail -f logs/bot.log`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å: `sudo systemctl status taskbot`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ `.env`

### –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î:
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ DATABASE_URL –≤ `.env`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ PostgreSQL –∑–∞–ø—É—â–µ–Ω: `sudo systemctl status postgresql`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ë–î

### "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω" –≤ –±–æ—Ç–µ:
- –î–æ–±–∞–≤—å—Ç–µ –≤–∞—à username –≤ —Ç–∞–±–ª–∏—Ü—É `allowed_users`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å username (–±–µ–∑ @)

---

## –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ (`logs/bot.log`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏ (`journalctl -u taskbot`)
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env` –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ
